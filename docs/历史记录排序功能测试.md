# 历史记录排序功能测试文档

## 功能概述

本次更新为Chrome扩展添加了历史记录排序配置功能，允许用户选择按时间或按使用频率对关键词预设进行排序。

## 新增功能

### 1. 全局设置新增排序配置
- **位置**: 设置页面 → 全局设置 → 历史记录排序
- **选项**:
  - 按添加时间排序（默认）：最新添加的关键词显示在前面
  - 按使用频率排序：使用次数最多的关键词显示在前面

### 2. 关键词预设增强显示
- **使用频率**: 显示每个关键词的使用次数
- **添加时间**: 显示关键词的创建时间（格式：YYYY-MM-DD HH:mm）
- **排序状态**: 在关键词预设管理区域显示当前排序方式

### 3. 数据结构扩展
- **SearchHistory接口**:
  - 新增 `usageCount?: number` 字段记录使用次数
  - 新增 `createdAt?: number` 字段记录创建时间
- **GlobalSettings接口**:
  - 新增 `historySortType?: HistorySortType` 字段配置排序方式

## 技术实现

### 1. 类型定义更新
```typescript
// 新增排序类型
export type HistorySortType = "time" | "frequency"

// 扩展SearchHistory接口
export interface SearchHistory {
  // ... 原有字段
  usageCount?: number;   // 使用次数
  createdAt?: number;    // 创建时间
}

// 扩展GlobalSettings接口
export interface GlobalSettings {
  // ... 原有字段
  historySortType?: HistorySortType; // 排序方式
}
```

### 2. 存储管理器增强
- **数据迁移**: 自动为旧数据添加新字段，确保向后兼容
- **使用计数**: 每次使用关键词时自动增加计数
- **排序逻辑**: 新增 `getSortedSearchHistory` 方法根据设置返回排序后的数据

### 3. UI组件更新
- **SettingsModal**: 添加排序方式选择界面
- **TemplateHistoryManager**: 支持实时排序切换和状态显示
- **HistoryItem**: 显示使用次数和创建时间信息

## 测试要点

### 1. 基础功能测试
- [ ] 设置页面能正确显示排序选项
- [ ] 排序方式切换后能立即生效
- [ ] 关键词预设显示使用次数和创建时间
- [ ] 排序状态标识正确显示

### 2. 数据兼容性测试
- [ ] 旧数据能正确迁移（自动添加默认值）
- [ ] 新创建的关键词包含完整信息
- [ ] 使用关键词后计数正确增加

### 3. 排序逻辑测试
- [ ] 按时间排序：最新的在前
- [ ] 按频率排序：使用次数多的在前，次数相同时按时间排序
- [ ] 排序方式变更后无需刷新页面

### 4. 用户体验测试
- [ ] 设置保存后立即生效
- [ ] 界面布局美观，信息显示清晰
- [ ] 排序状态有明确的视觉反馈

## 使用说明

### 配置排序方式
1. 点击扩展图标打开主页面
2. 点击右上角设置按钮
3. 在"全局设置"标签页找到"历史记录排序"区域
4. 选择所需的排序方式
5. 点击"保存设置"

### 查看关键词统计
1. 在模板管理页面编辑任意模板
2. 展开"关键词预设管理"区域
3. 查看每个关键词的使用次数和创建时间
4. 观察排序状态标识

## 注意事项

1. **向后兼容**: 旧版本数据会自动迁移，无需手动处理
2. **性能考虑**: 排序在数据获取时进行，不影响界面响应速度
3. **数据持久化**: 所有设置和统计数据都会自动保存到Chrome存储
4. **实时更新**: 设置变更后会通过Chrome存储事件实时同步到所有页面

## 最新更新（主页搜索建议增强）

### 新增功能
- **主页搜索建议排序**: 搜索框的历史建议现在也遵循全局排序设置
- **动态图标显示**: 根据排序方式显示不同图标
  - 按时间排序：显示时钟图标 ⏰
  - 按频率排序：显示柱状图图标 📊
- **动态信息显示**:
  - 按时间排序：显示相对时间（如"2小时前"）
  - 按频率排序：显示使用次数（如"5 次"）

### 技术实现
- **SearchSuggestions组件**: 使用`getSortedSearchHistory`获取排序后的数据
- **SuggestionItem组件**: 根据`sortType`参数动态显示图标和信息
- **SearchMatcher工具**: 保持传入数据的原有排序，不再重新排序
- **实时更新**: 监听全局设置变化，自动刷新搜索建议

### 测试要点（更新）

#### 主页搜索建议测试
- [ ] 搜索框聚焦时显示的历史建议按设置的排序方式排列
- [ ] 按时间排序时显示时钟图标和相对时间
- [ ] 按频率排序时显示柱状图图标和使用次数
- [ ] 排序方式变更后搜索建议立即更新（无需重新聚焦）
- [ ] 搜索建议的排序与模板管理页面的关键词预设排序一致

#### 完整功能测试流程
1. **设置排序方式为"按时间排序"**
   - 主页搜索建议显示时钟图标和相对时间
   - 模板管理页面关键词预设按时间排序

2. **设置排序方式为"按频率排序"**
   - 主页搜索建议显示柱状图图标和使用次数
   - 模板管理页面关键词预设按使用频率排序

3. **使用关键词进行搜索**
   - 使用次数正确增加
   - 按频率排序时高频关键词排在前面

## 后续优化建议

1. 可考虑添加更多排序选项（如按字母顺序）
2. 可添加关键词使用趋势图表
3. 可支持导出关键词使用统计报告
4. 可添加关键词使用热力图显示
